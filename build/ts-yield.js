// Generated by CoffeeScript 1.6.3
(function() {
  var fs, funcs, params, path, writestreamp;

  funcs = require('./functions');

  path = require('path');

  fs = require('fs');

  params = require('commander');

  writestreamp = require('writestreamp');

  params.version('0.2.1').usage('-o <dir> source1 [ source2 ]').option('-w, --watch', 'Watch for file changes').option('-o, --output-dir <dir>', 'Output directory for the built files (required)').parse(process.argv);

  if (!params.outputDir) {
    params.help();
  }

  params.args.forEach(function(source) {
    var exec, file, target;
    file = path.join(process.cwd(), source);
    target = path.join(params.outputDir || process.cwd(), source);
    exec = function(curr, prev) {
      if (fs.statSync(file).isFile()) {
        return fs.readFile(file, {
          encoding: 'utf8'
        }, function(arr, content) {
          var destination;
          content = funcs.unwrapYield(content);
          content = funcs.markGenerators(content);
          destination = writestreamp(target);
          return destination.write(content, destination.end.bind(destination));
        });
      }
    };
    if (params.watch) {
      fs.watchFile(file, {
        persistent: true,
        interval: 500
      }, exec);
      return exec();
    } else {
      return exec();
    }
  });

}).call(this);
